# -----------------------------------------------------------------------------
# Trading-CI 环境变量示例（复制为 .env 后按需修改）
#
# 说明：
# - 采用 dotenv 格式：KEY=VALUE
# - 所有注释仅供参考，真正使用时请把 KEY=VALUE 行保留即可
# - 带有【必填】标记的项，不填写会导致服务启动失败
# - 若使用 docker compose（本项目默认），.env 会被所有服务共享加载
# -----------------------------------------------------------------------------

# =========================
# 基础运行环境
# =========================
# ENV：运行环境标识（影响日志/默认开关），推荐：dev / prod
ENV=dev

# TIMEZONE：时区（用于日志时间、调度时间），默认 Asia/Dubai
TIMEZONE=Asia/Dubai


# =========================
# 外部依赖：Postgres / Redis
# =========================
# DATABASE_URL：【必填】外部 Postgres 连接串
# 参考值（同网络内的 postgres 容器）：
#   postgresql://trading:trading@postgres:5432/trading-ci
# 参考值（连接宿主机的 Postgres，Linux 需改成真实 IP）：
#   postgresql://trading:trading@host.docker.internal:5432/trading-ci
# 备注：如果你的数据库名包含 '-'，在 Postgres 里创建时需要双引号：
#   CREATE DATABASE "trading-ci";
DATABASE_URL=postgresql://user:pass@host:5432/trading-ci

# REDIS_URL：【必填】外部 Redis 连接串
# 参考值（无密码）：
#   redis://redis:6379/0
# 参考值（带密码）：
#   redis://:YOUR_REDIS_PASSWORD@redis:6379/0
REDIS_URL=redis://:pass@host:6379/0

# REDIS_STREAM_GROUP：Redis Streams consumer group 名称（init 时会自动创建，幂等）
REDIS_STREAM_GROUP=bot-group

# REDIS_STREAM_CONSUMER：当前实例的 consumer 名称（同一 group 下建议每个实例不同）
REDIS_STREAM_CONSUMER=bot-consumer-1


# =========================
# Bybit（REST + WebSocket）
# =========================
# BYBIT_API_KEY：Bybit API Key（实盘/模拟盘都需要），留空则执行/下单会失败
BYBIT_API_KEY=YOUR_KEY

# BYBIT_API_SECRET：Bybit API Secret
BYBIT_API_SECRET=YOUR_SECRET

# BYBIT_BASE_URL：Bybit 基础 URL（保留默认即可）
BYBIT_BASE_URL=https://api.bybit.com

# BYBIT_REST_BASE_URL：执行服务使用的 REST Base URL（一般与 BYBIT_BASE_URL 相同）
BYBIT_REST_BASE_URL=https://api.bybit.com

# BYBIT_WS_PUBLIC_URL：行情公共 WS（线性合约）
BYBIT_WS_PUBLIC_URL=wss://stream.bybit.com/v5/public/linear

# BYBIT_WS_PRIVATE_URL：私有 WS（订单/持仓等）
BYBIT_WS_PRIVATE_URL=wss://stream.bybit.com/v5/private

# BYBIT_RECV_WINDOW：REST 请求 recv_window（毫秒），默认 5000
BYBIT_RECV_WINDOW=5000

# BYBIT_ACCOUNT_TYPE：账户类型（Bybit v5 常用 UNIFIED）
BYBIT_ACCOUNT_TYPE=UNIFIED

# BYBIT_CATEGORY：品类（linear=U本位永续；如需反向/现货请按你的策略修改）
BYBIT_CATEGORY=linear

# BYBIT_POSITION_IDX：持仓模式索引（0=单向；1/2=对冲双向，按你的账户设置）
BYBIT_POSITION_IDX=0


# =========================
# 运行模式（Execution）
# =========================
# EXECUTION_MODE：执行模式
# - LIVE：真实下单
# - PAPER：纸面交易（不下单，仅记录）
# - BACKTEST：回测模式（如项目实现了相关路径）
EXECUTION_MODE=LIVE

# ORDER_POLL_INTERVAL_SEC：下单后轮询间隔（秒）
ORDER_POLL_INTERVAL_SEC=1

# ORDER_POLL_TIMEOUT_SEC：下单后轮询超时（秒）
ORDER_POLL_TIMEOUT_SEC=20


# =========================
# 策略 / 风控（默认值可直接用）
# =========================
# RISK_PCT：单笔风险比例（例如 0.005=0.5%）
RISK_PCT=0.005

# MAX_OPEN_POSITIONS_DEFAULT：默认最大同时持仓数量
MAX_OPEN_POSITIONS_DEFAULT=3

# MIN_CONFIRMATIONS：信号确认次数（需求里固定 2，不建议改）
MIN_CONFIRMATIONS=2

# AUTO_TIMEFRAMES：自动生成/计算的核心周期（逗号分隔）
AUTO_TIMEFRAMES=1h,4h,1d

# MONITOR_TIMEFRAMES：监控周期（逗号分隔）
MONITOR_TIMEFRAMES=15m,30m,8h

# ACCOUNT_KILL_SWITCH_ENABLED：账户级“一键熔断”（true/false）
# true 时可直接阻断执行（用于紧急止损/停机）
ACCOUNT_KILL_SWITCH_ENABLED=false

# DAILY_LOSS_LIMIT_PCT：当日亏损上限（比例），触发后可阻断新开仓
DAILY_LOSS_LIMIT_PCT=0.03

# ENABLE_SIGNAL_SCORING：可选增强：信号打分（默认 false，不改变策略）
ENABLE_SIGNAL_SCORING=false

# ENABLE_MARKET_STATE：可选增强：市场状态标记（默认 false，不改变策略）
ENABLE_MARKET_STATE=false

# ENABLE_ORDER_RETRY：下单失败重试开关（默认 true）
ENABLE_ORDER_RETRY=true


# =========================
# 冷却期（按 bar 数）
# =========================
# COOLDOWN_ENABLED：是否开启冷却（true/false）
COOLDOWN_ENABLED=true

# COOLDOWN_BARS_1H：1h 周期冷却 bar 数
COOLDOWN_BARS_1H=2

# COOLDOWN_BARS_4H：4h 周期冷却 bar 数
COOLDOWN_BARS_4H=1

# COOLDOWN_BARS_1D：1d 周期冷却 bar 数
COOLDOWN_BARS_1D=1


# =========================
# 账户级风险熔断（execution 风控）
# =========================
# RISK_CIRCUIT_ENABLED：是否启用熔断监控（true/false）
RISK_CIRCUIT_ENABLED=false

# DAILY_DRAWDOWN_SOFT_PCT：软阈值回撤比例（触发告警/降级）
DAILY_DRAWDOWN_SOFT_PCT=0.02

# DAILY_DRAWDOWN_HARD_PCT：硬阈值回撤比例（触发熔断）
DAILY_DRAWDOWN_HARD_PCT=0.04

# RISK_MONITOR_INTERVAL_SEC：风控监控轮询间隔（秒）
RISK_MONITOR_INTERVAL_SEC=10


# =========================
# Runner / 追踪止损（Trailing）
# =========================
# RUNNER_TRAIL_MODE：追踪止损模式（参考：ATR / FIXED，具体以代码实现为准）
RUNNER_TRAIL_MODE=ATR

# RUNNER_ATR_PERIOD：ATR 周期
RUNNER_ATR_PERIOD=14

# RUNNER_ATR_MULT：ATR 倍数（追踪距离）
RUNNER_ATR_MULT=3.0


# =========================
# Notifier（通知重试）
# =========================
# NOTIFIER_MAX_ATTEMPTS：通知最大重试次数
NOTIFIER_MAX_ATTEMPTS=5

# NOTIFIER_RETRY_LOOP_INTERVAL_SEC：重试循环间隔（秒）
NOTIFIER_RETRY_LOOP_INTERVAL_SEC=5


# =========================
# Telegram（可选；留空则不发送）
# =========================
# TELEGRAM_BOT_TOKEN：机器人 token
TELEGRAM_BOT_TOKEN=

# TELEGRAM_CHAT_ID：目标 chat_id（个人或群）
TELEGRAM_CHAT_ID=


# =========================
# 指标 / 告警阈值（只告警不改变执行）
# =========================
# ACCOUNT_SNAPSHOT_INTERVAL_SEC：账户快照采集周期（秒）
ACCOUNT_SNAPSHOT_INTERVAL_SEC=30

# ALERT_STREAM_LAG_ENABLED：是否启用 Streams 延迟告警（true/false）
ALERT_STREAM_LAG_ENABLED=true

# ALERT_TRADE_PLAN_LAG_MS：trade_plan 处理延迟阈值（毫秒）
ALERT_TRADE_PLAN_LAG_MS=60000

# ALERT_BAR_CLOSE_LAG_MS：bar close 处理延迟阈值（毫秒）
ALERT_BAR_CLOSE_LAG_MS=120000


# =========================
# API 管理口令
# =========================
# ADMIN_TOKEN：API 管理口令（建议修改为长随机字符串）
ADMIN_TOKEN=change_me


# =========================
# Marketdata 服务专用（启动订阅/回填）
# =========================
# MARKETDATA_SYMBOLS：订阅交易对（逗号分隔）
MARKETDATA_SYMBOLS=BTCUSDT

# MARKETDATA_TIMEFRAMES：订阅周期（逗号分隔）
MARKETDATA_TIMEFRAMES=15m,30m,1h,4h,8h,1d

# MARKETDATA_ENABLE_REST_BACKFILL：启动时是否进行 REST 回填（true/false）
# 说明：回填会写库，但不会发布事件（用于补历史）
MARKETDATA_ENABLE_REST_BACKFILL=true

# MARKETDATA_BACKFILL_LIMIT：每个 (symbol,timeframe) 回填数量（建议 <=1000）
MARKETDATA_BACKFILL_LIMIT=500

# MARKETDATA_GAPFILL_ENABLED：是否启用缺口补齐（true/false）
MARKETDATA_GAPFILL_ENABLED=true

# MARKETDATA_GAPFILL_MAX_BARS：最大补齐 bar 数（过大可能导致启动耗时）
MARKETDATA_GAPFILL_MAX_BARS=2000


# =========================
# 容器启动初始化开关（一般不需要改）
# =========================
# SKIP_DB_MIGRATIONS：跳过 Postgres migrations（1=跳过）
SKIP_DB_MIGRATIONS=0

# SKIP_REDIS_STREAMS_INIT：跳过 Redis Streams/Group 初始化（1=跳过）
SKIP_REDIS_STREAMS_INIT=0

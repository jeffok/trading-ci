# ==============================================================================
# trading-ci 环境变量配置示例
# ==============================================================================
# 说明：
# 1. 复制此文件为 .env 并根据实际情况修改
# 2. 实盘交易前请仔细阅读 LIVE_TRADING_GUIDE.md
# 3. 所有参数都有默认值，但实盘交易建议明确配置
# 4. 参数说明格式：参数作用 | 可选值 | 实盘建议值 | 详细说明
# ==============================================================================

# ========== 基础配置 ==========
# 环境标识
# 作用：标识当前运行环境，用于日志和事件标记
# 可选值：dev（开发）、test（测试）、prod（生产）
# 实盘建议值：prod
ENV=dev

# 时区设置
# 作用：系统使用的时区，影响时间戳解析和日志时间显示
# 可选值：任何有效的时区名称（如 Asia/Dubai、Asia/Shanghai、UTC）
# 实盘建议值：Asia/Dubai（与 Bybit 时区一致）
TIMEZONE=Asia/Dubai

# ========== 外部依赖（必填） ==========
# PostgreSQL 数据库连接 URL
# 作用：系统主数据库，存储所有交易数据、订单、持仓、信号等
# 格式：postgresql://用户名:密码@主机:端口/数据库名
# 实盘建议：使用独立的数据库实例，确保数据安全和备份
# 示例：postgresql://postgres:password@localhost:5432/trading-ci
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/trading-ci

# Redis 连接 URL（用于 Redis Streams）
# 作用：消息队列系统，用于服务间事件传递（bar_close、trade_plan、execution_report 等）
# 格式：redis://主机:端口/数据库编号
# 实盘建议：使用独立的 Redis 实例，确保消息队列稳定
# 示例：redis://localhost:6379/0
REDIS_URL=redis://localhost:6379/0

# ========== Redis Streams ==========
# Redis Streams 消费者组名称
# 作用：多个服务实例可以共享同一个消费者组，实现负载均衡
# 实盘建议值：保持默认即可（bot-group）
REDIS_STREAM_GROUP=bot-group

# Redis Streams 消费者名称
# 作用：标识当前消费者实例，用于监控和调试
# 实盘建议值：保持默认即可（bot-consumer-1）
REDIS_STREAM_CONSUMER=bot-consumer-1

# ========== Bybit API（实盘交易必填） ==========
# Bybit API Key
# 作用：用于访问 Bybit API 的身份凭证
# 获取方式：Bybit 账户中心 -> API 管理 -> 创建 API Key
# 权限要求：需要交易权限（下单、平仓、设置止损止盈）
# 实盘必填：必须配置，否则无法下单
BYBIT_API_KEY=

# Bybit API Secret
# 作用：API Key 的密钥，用于签名验证
# 获取方式：创建 API Key 时生成，只显示一次，请妥善保管
# 安全提示：不要泄露给任何人，不要提交到代码仓库
# 实盘必填：必须配置，否则无法下单
BYBIT_API_SECRET=

# Bybit REST API 基础 URL
# 作用：Bybit REST API 的主网地址
# 可选值：
#   - https://api.bybit.com（主网，实盘使用）
#   - https://api-testnet.bybit.com（测试网，仅用于测试）
# 实盘建议值：https://api.bybit.com（主网）
BYBIT_BASE_URL=https://api.bybit.com

# Bybit REST API 基础 URL（执行服务专用）
# 作用：执行服务专用的 REST API 地址，可以与 BYBIT_BASE_URL 不同
# 可选值：同 BYBIT_BASE_URL
# 实盘建议值：https://api.bybit.com（主网）
BYBIT_REST_BASE_URL=https://api.bybit.com

# Bybit 公共 WebSocket URL
# 作用：订阅公共市场数据（K 线、行情等）的 WebSocket 地址
# 实盘建议值：保持默认即可（wss://stream.bybit.com/v5/public/linear）
BYBIT_WS_PUBLIC_URL=wss://stream.bybit.com/v5/public/linear

# Bybit 私有 WebSocket URL
# 作用：订阅私有数据（订单、持仓、钱包等）的 WebSocket 地址
# 实盘建议值：保持默认即可（wss://stream.bybit.com/v5/private）
BYBIT_WS_PRIVATE_URL=wss://stream.bybit.com/v5/private

# Bybit 账户类型
# 作用：指定使用的账户类型
# 可选值：
#   - UNIFIED（统一账户，推荐）
#   - CONTRACT（合约账户）
#   - SPOT（现货账户）
# 实盘建议值：UNIFIED（统一账户，支持多产品交易）
BYBIT_ACCOUNT_TYPE=UNIFIED

# Bybit 交易类别
# 作用：指定交易的产品类别
# 可选值：
#   - linear（永续合约，推荐）
#   - inverse（反向合约）
#   - spot（现货）
# 实盘建议值：linear（永续合约）
BYBIT_CATEGORY=linear

# Bybit 持仓模式索引
# 作用：指定持仓模式
# 可选值：
#   - 0（单向持仓模式，推荐）
#   - 1（Buy 侧对冲模式）
#   - 2（Sell 侧对冲模式）
# 实盘建议值：0（单向持仓模式，简单易用）
BYBIT_POSITION_IDX=0

# Bybit API 请求接收窗口（毫秒）
# 作用：API 请求的时间戳验证窗口，防止重放攻击
# 范围：1000-60000（毫秒）
# 实盘建议值：5000（5秒，平衡安全性和灵活性）
BYBIT_RECV_WINDOW=5000

# ========== Bybit 私有 WebSocket ==========
# Bybit 私有 WebSocket 是否启用
# 作用：是否启用私有 WebSocket 实时接收订单、持仓、钱包更新
# 可选值：
#   - true（启用，推荐）
#   - false（禁用，使用 REST API 轮询）
# 实盘建议值：true（启用后可减少 REST API 轮询压力，提高实时性，降低限流风险）
# 优势：实时性强（毫秒级）、减少 API 调用、自动同步订单状态
BYBIT_PRIVATE_WS_ENABLED=false

# Bybit 私有 WebSocket URL
# 作用：私有 WebSocket 的连接地址
# 实盘建议值：保持默认即可（wss://stream.bybit.com/v5/private）
BYBIT_PRIVATE_WS_URL=wss://stream.bybit.com/v5/private

# Bybit 私有 WebSocket 认证路径
# 作用：WebSocket 认证的路径
# 实盘建议值：保持默认即可（/realtime）
BYBIT_PRIVATE_WS_AUTH_PATH=/realtime

# Bybit 私有 WebSocket 订阅主题
# 作用：指定要订阅的事件类型，多个用逗号分隔
# 可选值：
#   - order（订单更新）
#   - execution（成交更新）
#   - position（持仓更新）
#   - wallet（钱包更新）
# 实盘建议值：order,execution,position,wallet（订阅所有相关事件，确保完整同步）
BYBIT_PRIVATE_WS_SUBSCRIPTIONS=order,execution,position,wallet

# ========== 策略/风控参数 ==========
# 风险百分比（每笔交易风险占权益的比例）
# 作用：控制每笔交易的最大风险，用于计算仓位大小
# 计算公式：风险金额 = 账户权益 × RISK_PCT
# 范围：0.0001-1.0（0.01%-100%）
# 实盘建议值：0.001-0.005（0.1%-0.5%），新手建议 0.001（0.1%）
# 示例：账户 10000 USDT，RISK_PCT=0.001，则每笔交易最多亏损 10 USDT
RISK_PCT=0.005

# 最大同时持仓数
# 作用：限制同时持有的未平仓数量，防止过度交易
# 范围：1-100
# 实盘建议值：1-3（保守策略建议 1，激进策略可设为 3）
# 说明：超过此数量时，新的交易计划会被拒绝（MAX_POSITIONS_BLOCKED）
MAX_OPEN_POSITIONS=3

# 最小确认数（策略信号需要满足的确认项数量）
# 作用：提高信号质量，只有满足足够确认项的信号才会生成交易计划
# 确认项包括：吞没形态、RSI 背离、OBV 背离、FVG 接近度等
# 范围：1-10
# 实盘建议值：2（保持默认，提高信号质量，减少假信号）
MIN_CONFIRMATIONS=2

# 自动下单时间框架（只有这些时间框架会生成 trade_plan）
# 作用：指定哪些时间框架的信号会自动生成交易计划并下单
# 格式：多个时间框架用逗号分隔
# 可选值：15m、30m、1h、4h、8h、1d
# 实盘建议值：1h,4h,1d（保持默认，避免过度交易，关注中长周期）
# 说明：其他时间框架（如 15m、30m、8h）只生成 signal，不自动下单
AUTO_TIMEFRAMES=1h,4h,1d

# 监控时间框架（只生成 signal，不生成 trade_plan）
# 作用：指定哪些时间框架只用于监控，不自动下单
# 格式：多个时间框架用逗号分隔
# 可选值：15m、30m、1h、4h、8h、1d
# 实盘建议值：15m,30m,8h（保持默认，用于监控短期和中期趋势）
MONITOR_TIMEFRAMES=15m,30m,8h

# ========== 仓位控制（实际价值） ==========
# 最低下单金额（USDT，实际价值，非合约名义价值）
# 作用：限制最小下单金额，避免过小的订单（手续费占比高、意义不大）
# 说明：实际价值 = (合约数量 × 入场价格) / 杠杆倍数，这是实际占用的保证金
# 范围：1.0-1000.0（USDT）
# 实盘建议值：10.0-50.0（根据账户大小调整，小账户建议 10，大账户可设为 50）
# 示例：账户 10000 USDT，建议设为 10 USDT
MIN_ORDER_VALUE_USDT=10.0

# 最高下单金额（USDT，实际价值，非合约名义价值）
# 作用：限制最大下单金额，控制单笔交易风险
# 说明：实际价值 = (合约数量 × 入场价格) / 杠杆倍数，这是实际占用的保证金
# 范围：100.0-100000.0（USDT）
# 实盘建议值：1000.0-10000.0（根据账户大小和风险承受能力调整）
# 示例：账户 10000 USDT，建议设为 1000 USDT（单笔不超过 10%）
MAX_ORDER_VALUE_USDT=10000.0

# 合约倍数（杠杆倍数）
# 作用：放大交易规模，提高资金利用率，但同时也放大风险
# 范围：1-125（Bybit 限制）
# 实盘建议值：1-10（保守策略建议 1-5，激进策略可设为 10）
# 说明：
#   - 杠杆越高，所需保证金越少，但风险越大
#   - 10倍杠杆意味着：1000 USDT 可以交易 10000 USDT 的合约
#   - 逐仓模式下必须设置，全仓模式下设为 0
LEVERAGE=1

# 保证金模式
# 作用：指定保证金计算方式，影响风险隔离
# 可选值：
#   - isolated（逐仓模式，推荐）
#   - cross（全仓模式，不推荐）
# 实盘建议值：isolated（逐仓模式，风险隔离，每个持仓独立保证金）
# 说明：
#   - 逐仓：每个持仓独立保证金，一个持仓爆仓不影响其他持仓
#   - 全仓：所有持仓共享保证金，风险更高，一个持仓亏损可能影响其他持仓
MARGIN_MODE=isolated

# ========== 账户熔断 ==========
# 账户级 Kill Switch 是否启用
# 作用：当日权益回撤超过限制时，自动停止所有新开仓，防止进一步亏损
# 可选值：
#   - true（启用，强烈推荐）
#   - false（禁用）
# 实盘建议值：true（强烈建议启用，防止异常情况下的过度交易）
# 说明：触发后只阻止新开仓，不会强制平仓现有持仓
ACCOUNT_KILL_SWITCH_ENABLED=false

# 每日亏损限制百分比（当日权益回撤超过此值触发 Kill Switch）
# 作用：设置账户级熔断的触发阈值
# 计算公式：当日亏损 = (当日初始权益 - 当前权益) / 当日初始权益
# 范围：0.01-1.0（1%-100%）
# 实盘建议值：0.02-0.03（2%-3%）
# 示例：账户 10000 USDT，DAILY_LOSS_LIMIT_PCT=0.02，当日亏损超过 200 USDT 时触发
DAILY_LOSS_LIMIT_PCT=0.03

# 账户 Kill Switch 强制启用（忽略其他条件）
# 作用：强制启用 Kill Switch，无论其他条件如何
# 可选值：
#   - true（强制启用）
#   - false（正常模式）
# 实盘建议值：false（仅在紧急情况下设为 true）
# 说明：设为 true 后，会立即阻止所有新开仓，用于紧急停止交易
ACCOUNT_KILL_SWITCH_FORCE_ON=false

# Kill Switch 标志名称（Redis 标志名称）
# 作用：Redis 中存储 Kill Switch 状态的键名
# 实盘建议值：保持默认即可（KILL_SWITCH）
KILL_SWITCH_FLAG_NAME=KILL_SWITCH

# Kill Switch 窗口时间（毫秒）
# 作用：Kill Switch 事件的去重窗口，避免短时间内重复触发
# 范围：60000-3600000（1分钟-1小时）
# 实盘建议值：300000（5分钟）
KILL_SWITCH_WINDOW_MS=300000

# ========== 风险熔断 ==========
# 风险熔断是否启用
# 作用：基于当日回撤的软硬熔断机制，提供额外的风险保护
# 可选值：
#   - true（启用，强烈推荐）
#   - false（禁用）
# 实盘建议值：true（强烈建议启用，提供额外的风险保护）
# 说明：
#   - 软熔断：停止新开仓
#   - 硬熔断：强制平仓所有持仓
RISK_CIRCUIT_ENABLED=false

# 每日回撤软限制百分比（触发软熔断，停止新开仓）
# 作用：设置软熔断的触发阈值
# 范围：0.01-1.0（1%-100%）
# 实盘建议值：0.01-0.02（1%-2%）
# 说明：触发后停止新开仓，但不会强制平仓现有持仓
DAILY_DRAWDOWN_SOFT_PCT=0.02

# 每日回撤硬限制百分比（触发硬熔断，强制平仓）
# 作用：设置硬熔断的触发阈值
# 范围：0.02-1.0（2%-100%）
# 实盘建议值：0.02-0.04（2%-4%）
# 说明：触发后会强制平仓所有持仓，这是最后的保护措施
DAILY_DRAWDOWN_HARD_PCT=0.04

# 风险监控间隔（秒）
# 作用：检查风险状态的频率
# 范围：1.0-60.0（秒）
# 实盘建议值：10.0（保持默认，实时监控）
RISK_MONITOR_INTERVAL_SEC=10.0

# ========== 执行模式 ==========
# 执行模式
# 作用：指定系统的运行模式，影响订单执行方式
# 可选值：
#   - LIVE（实盘模式，真实下单到交易所）
#   - PAPER（模拟盘模式，模拟下单，不调用交易所 API）
#   - BACKTEST（回测模式，用于历史数据回测）
# 实盘必填：LIVE
# 说明：
#   - LIVE：真实交易，需要配置 BYBIT_API_KEY 和 BYBIT_API_SECRET
#   - PAPER：模拟交易，用于测试和调试，不消耗真实资金
#   - BACKTEST：历史回测，用于策略验证
EXECUTION_MODE=LIVE

# ========== 入场订单配置 ==========
# 入场订单类型
# 作用：指定入场订单的类型
# 可选值：
#   - Market（市价单，推荐）
#   - Limit（限价单）
# 实盘建议值：Market（保证成交速度，适合快速入场）
# 说明：
#   - Market：立即以当前市场价格成交，保证成交速度
#   - Limit：以指定价格挂单，可能未成交，系统会自动重试或降级为 Market
EXECUTION_ENTRY_ORDER_TYPE=Market

# Limit 订单超时时间（毫秒）
# 作用：Limit 订单如果在此时间内未成交，则取消并重试
# 范围：5000-60000（5秒-60秒）
# 实盘建议值：15000（15秒，如果未成交则取消并重试）
# 说明：仅当 EXECUTION_ENTRY_ORDER_TYPE=Limit 时生效
EXECUTION_ENTRY_TIMEOUT_MS=15000

# Limit 订单最大重试次数
# 作用：Limit 订单未成交时的最大重试次数
# 范围：1-5
# 实盘建议值：2（保持默认，避免无限重试）
# 说明：每次重试会重新定价（价格调整 EXECUTION_ENTRY_REPRICE_BPS）
EXECUTION_ENTRY_MAX_RETRIES=2

# Limit 订单重试时重新定价基点（bps）
# 作用：每次重试时价格调整的幅度（1 bps = 0.01%）
# 范围：1-50（bps）
# 实盘建议值：5（每次重试价格调整 5 bps，约 0.05%）
# 说明：做多时加价，做空时减价，提高成交概率
EXECUTION_ENTRY_REPRICE_BPS=5

# Limit 订单失败后是否降级为 Market 订单
# 作用：Limit 订单重试失败后，是否自动降级为 Market 订单
# 可选值：
#   - true（降级为 Market，推荐）
#   - false（不降级，直接失败）
# 实盘建议值：true（保证最终成交）
# 说明：确保交易计划能够执行，避免因价格波动导致订单失败
EXECUTION_ENTRY_FALLBACK_MARKET=true

# Limit 订单部分成交超时时间（毫秒）
# 作用：Limit 订单部分成交后，如果剩余部分在此时间内未成交，则取消剩余部分
# 范围：10000-60000（10秒-60秒）
# 实盘建议值：20000（20秒，如果部分成交停滞则取消剩余）
# 说明：避免订单长期处于部分成交状态
EXECUTION_ENTRY_PARTIAL_FILL_TIMEOUT_MS=20000

# ========== 冷却期 ==========
# 冷却期是否启用（止损后禁止同币种同方向再次开仓）
# 作用：止损后禁止同币种同方向再次开仓，避免频繁止损
# 可选值：
#   - true（启用，强烈推荐）
#   - false（禁用）
# 实盘建议值：true（强烈建议启用，避免频繁止损）
# 说明：触发止损后，在冷却期内（根据时间框架设置），不允许再次开仓
COOLDOWN_ENABLED=true

# 1h 时间框架冷却期（bar 数）
# 作用：1h 时间框架止损后，需要等待多少根 K 线才能再次开仓
# 范围：1-10
# 实盘建议值：2（止损后等待 2 根 1h K 线，即 2 小时）
COOLDOWN_BARS_1H=2

# 4h 时间框架冷却期（bar 数）
# 作用：4h 时间框架止损后，需要等待多少根 K 线才能再次开仓
# 范围：1-5
# 实盘建议值：1（止损后等待 1 根 4h K 线，即 4 小时）
COOLDOWN_BARS_4H=1

# 1d 时间框架冷却期（bar 数）
# 作用：1d 时间框架止损后，需要等待多少根 K 线才能再次开仓
# 范围：1-3
# 实盘建议值：1（止损后等待 1 根 1d K 线，即 1 天）
COOLDOWN_BARS_1D=1

# ========== 持仓互斥 ==========
# 持仓互斥升级动作（当高优先级周期信号到来时的处理策略）
# 作用：当高优先级周期信号到来且存在低优先级同向仓位时的处理方式
# 可选值：
#   - BLOCK（直接拒绝新信号，最保守）
#   - CLOSE_LOWER_AND_OPEN（先强制平掉低优先级仓位，再执行新开仓，推荐）
# 实盘建议值：CLOSE_LOWER_AND_OPEN（先平后开，充分利用高优先级信号）
# 说明：
#   - 时间框架优先级：1d > 4h > 1h > 其他
#   - BLOCK：保守策略，避免频繁换仓
#   - CLOSE_LOWER_AND_OPEN：激进策略，优先执行高优先级信号
POSITION_MUTEX_UPGRADE_ACTION=CLOSE_LOWER_AND_OPEN

# ========== Runner 跟随止损 ==========
# Runner 跟随止损模式
# 作用：指定 Runner（剩余 20% 仓位）的跟随止损计算方式
# 可选值：
#   - ATR（基于 ATR，推荐）
#   - PIVOT（基于 Pivot 点）
# 实盘建议值：ATR（保持默认，更稳定，基于波动率）
# 说明：
#   - ATR：基于平均真实波幅，动态调整止损距离
#   - PIVOT：基于最近的 Pivot 点，更贴近价格结构
RUNNER_TRAIL_MODE=ATR

# Runner ATR 周期
# 作用：计算 ATR 时使用的周期长度
# 范围：5-50
# 实盘建议值：14（保持默认，标准 ATR 周期）
RUNNER_ATR_PERIOD=14

# Runner ATR 倍数
# 作用：ATR 的倍数，用于计算止损距离
# 范围：1.0-10.0
# 实盘建议值：3.0（保持默认，提供足够的止损空间）
# 说明：倍数越大，止损距离越远，不容易被震荡触发
RUNNER_ATR_MULT=3.0

# Runner 实时更新是否启用（LIVE 模式下持续更新止损）
# 作用：TP2 成交后，是否实时更新 Runner 的跟随止损
# 可选值：
#   - true（启用，推荐）
#   - false（禁用）
# 实盘建议值：true（保持默认，实时保护利润）
# 说明：启用后，每根 K 线收盘时都会更新 Runner 止损，保护已实现利润
RUNNER_LIVE_UPDATE_ENABLED=true

# Runner 实时更新最小间隔（毫秒）
# 作用：两次 Runner 止损更新的最小时间间隔，避免过于频繁的更新
# 范围：1000-10000（1秒-10秒）
# 实盘建议值：3000（3秒，避免过于频繁的更新）
RUNNER_LIVE_UPDATE_MIN_INTERVAL_MS=3000

# ========== 二级规则 ==========
# 二级规则是否启用（次日规则：如果下一根 K 线未缩短则退出）
# 作用：如果下一根 K 线 MACD histogram 未缩短，则退出持仓
# 可选值：
#   - true（启用，推荐）
#   - false（禁用）
# 实盘建议值：true（保持默认，提供额外的退出保护）
# 说明：这是一个额外的退出规则，用于捕捉趋势反转信号
SECONDARY_RULE_ENABLED=true

# ========== 交易计划生命周期 ==========
# 交易计划 TTL（bar 数，超过此数量未执行则过期）
# 作用：交易计划的有效期，超过此时间未执行则自动过期
# 范围：1-10
# 实盘建议值：1（保持默认，只执行当前 K 线的交易计划）
# 说明：设为 1 表示交易计划只在当前 K 线有效，过期后不再执行
TRADE_PLAN_TTL_BARS=1

# 信号 TTL（bar 数，超过此数量未执行则过期）
# 作用：信号的有效期，超过此时间未执行则自动过期
# 范围：1-10
# 实盘建议值：1（保持默认，只执行当前 K 线的信号）
SIGNAL_TTL_BARS=1

# ========== 市场状态 ==========
# 市场状态标记是否启用
# 作用：是否启用市场状态标记（高波动、新闻窗口等），仅用于观察
# 可选值：
#   - true（启用）
#   - false（禁用，推荐）
# 实盘建议值：false（保持默认，仅用于观察，不影响交易逻辑）
MARKET_STATE_ENABLED=false

# 市场高波动阈值百分比
# 作用：超过此波动率时标记为高波动市场
# 范围：0.01-0.20（1%-20%）
# 实盘建议值：0.04（4%，超过此值标记为高波动）
MARKET_HIGH_VOL_PCT=0.04

# 市场状态在正常状态下是否发送事件
# 作用：正常市场状态下是否也发送市场状态事件
# 可选值：
#   - true（发送）
#   - false（不发送，推荐）
# 实盘建议值：false（保持默认，只发送异常状态）
MARKET_STATE_EMIT_ON_NORMAL=false

# 市场 ATR 周期
# 作用：计算市场 ATR 时使用的周期长度
# 范围：5-50
# 实盘建议值：14（保持默认）
MARKET_ATR_PERIOD=14

# 新闻窗口 UTC 时间（格式：HH:MM-HH:MM，多个用逗号分隔）
# 作用：指定新闻发布的时间窗口，在此时间段内标记为新闻窗口
# 格式：HH:MM-HH:MM（如 08:00-09:00），多个窗口用逗号分隔
# 实盘建议值：空（不设置，或根据实际新闻时间设置）
# 示例：08:00-09:00,20:00-21:00（UTC 时间）
NEWS_WINDOW_UTC=

# ========== 数据质量检查 ==========
# 数据质量检查是否启用
# 作用：是否启用数据质量监控（延迟、价格跳涨、成交量异常等）
# 可选值：
#   - true（启用，推荐）
#   - false（禁用）
# 实盘建议值：true（保持默认，监控数据质量）
DATA_QUALITY_ENABLED=true

# 数据延迟阈值（毫秒）
# 作用：K 线数据延迟超过此值时触发告警
# 范围：60000-600000（1分钟-10分钟）
# 实盘建议值：180000（3分钟，超过此值触发告警）
DATA_QUALITY_LAG_MS=180000

# 价格跳涨阈值百分比
# 作用：相邻 K 线价格变化超过此值时触发告警
# 范围：0.01-0.50（1%-50%）
# 实盘建议值：0.08（8%，超过此值触发告警）
DATA_QUALITY_PRICE_JUMP_PCT=0.08

# 成交量异常倍数
# 作用：当前成交量超过平均成交量的倍数时触发告警
# 范围：5.0-50.0
# 实盘建议值：10.0（超过平均成交量 10 倍触发告警）
DATA_QUALITY_VOLUME_SPIKE_MULTIPLE=10.0

# 成交量窗口（用于计算平均成交量）
# 作用：计算平均成交量时使用的历史 K 线数量
# 范围：10-100
# 实盘建议值：30（保持默认）
DATA_QUALITY_VOLUME_WINDOW=30

# ========== 一致性检查 ==========
# WS/DB 一致性漂移检测是否启用
# 作用：监控 WebSocket 数据和数据库数据的一致性
# 可选值：
#   - true（启用，推荐）
#   - false（禁用）
# 实盘建议值：true（保持默认，监控数据一致性）
CONSISTENCY_DRIFT_ENABLED=true

# 一致性漂移阈值百分比
# 作用：WebSocket 和数据库数据差异超过此值时触发告警
# 范围：0.01-1.0（1%-100%）
# 实盘建议值：0.10（10%，超过此值触发告警）
CONSISTENCY_DRIFT_THRESHOLD_PCT=0.10

# 一致性漂移窗口（毫秒）
# 作用：一致性检查的时间窗口
# 范围：60000-1800000（1分钟-30分钟）
# 实盘建议值：300000（5分钟）
CONSISTENCY_DRIFT_WINDOW_MS=300000

# ========== 钱包对比 ==========
# 钱包对比是否启用（对比 WS 和 REST 钱包余额）
# 作用：对比 WebSocket 和 REST API 返回的钱包余额，检测数据一致性
# 可选值：
#   - true（启用，推荐）
#   - false（禁用）
# 实盘建议值：true（保持默认，监控钱包一致性）
WALLET_COMPARE_ENABLED=true

# Bybit 钱包币种
# 作用：指定要监控的钱包币种
# 可选值：USDT、BTC、ETH 等
# 实盘建议值：USDT（保持默认）
BYBIT_WALLET_COIN=USDT

# 钱包 WS 数据最大年龄（毫秒）
# 作用：WebSocket 钱包数据的最大有效期，超过此时间认为数据过期
# 范围：30000-300000（30秒-5分钟）
# 实盘建议值：90000（90秒，超过此值认为 WS 数据过期）
WALLET_WS_MAX_AGE_MS=90000

# 钱包漂移阈值百分比
# 作用：WebSocket 和 REST API 钱包余额差异超过此值时触发告警
# 范围：0.001-0.10（0.1%-10%）
# 实盘建议值：0.02（2%，超过此值触发告警）
WALLET_DRIFT_THRESHOLD_PCT=0.02

# 钱包漂移窗口（毫秒）
# 作用：钱包对比检查的时间窗口
# 范围：60000-1800000（1分钟-30分钟）
# 实盘建议值：300000（5分钟）
WALLET_DRIFT_WINDOW_MS=300000

# ========== Bybit 限频配置 ==========
# Bybit 公共 API 请求速率（每秒请求数）
# 作用：限制公共 API 的请求频率，避免触发限流
# 范围：1.0-20.0（RPS）
# 实盘建议值：8.0（保持默认，避免触发限流）
BYBIT_PUBLIC_RPS=8.0

# Bybit 公共 API 突发请求数
# 作用：允许的突发请求数量
# 范围：2.0-40.0
# 实盘建议值：16.0（保持默认）
BYBIT_PUBLIC_BURST=16.0

# Bybit 私有关键 API 请求速率（下单、取消、设置止损等）
# 作用：限制关键操作的请求频率
# 范围：1.0-10.0（RPS）
# 实盘建议值：3.0（保持默认，关键操作需要更保守）
BYBIT_PRIVATE_CRITICAL_RPS=3.0

# Bybit 私有关键 API 突发请求数
# 作用：允许的突发请求数量
# 范围：2.0-20.0
# 实盘建议值：6.0（保持默认）
BYBIT_PRIVATE_CRITICAL_BURST=6.0

# Bybit 私有查询 API 请求速率（查询订单、持仓等）
# 作用：限制查询操作的请求频率
# 范围：0.5-5.0（RPS）
# 实盘建议值：2.0（保持默认）
BYBIT_PRIVATE_QUERY_RPS=2.0

# Bybit 私有查询 API 突发请求数
# 作用：允许的突发请求数量
# 范围：1.0-10.0
# 实盘建议值：4.0（保持默认）
BYBIT_PRIVATE_QUERY_BURST=4.0

# Bybit 私有订单查询 API 请求速率
# 作用：限制订单查询的请求频率
# 范围：0.5-5.0（RPS）
# 实盘建议值：2.0（保持默认）
BYBIT_PRIVATE_ORDER_QUERY_RPS=2.0

# Bybit 私有订单查询 API 突发请求数
# 作用：允许的突发请求数量
# 范围：1.0-10.0
# 实盘建议值：4.0（保持默认）
BYBIT_PRIVATE_ORDER_QUERY_BURST=4.0

# Bybit 私有账户查询 API 请求速率
# 作用：限制账户查询的请求频率
# 范围：0.5-5.0（RPS）
# 实盘建议值：2.0（保持默认）
BYBIT_PRIVATE_ACCOUNT_QUERY_RPS=2.0

# Bybit 私有账户查询 API 突发请求数
# 作用：允许的突发请求数量
# 范围：1.0-10.0
# 实盘建议值：4.0（保持默认）
BYBIT_PRIVATE_ACCOUNT_QUERY_BURST=4.0

# Bybit 每个交易对的查询请求速率
# 作用：限制每个交易对的查询频率，防止多交易对时请求过多
# 范围：0.1-2.0（RPS）
# 实盘建议值：0.7（保持默认）
BYBIT_PRIVATE_PER_SYMBOL_QUERY_RPS=0.7

# Bybit 每个交易对的查询突发请求数
# 作用：允许的突发请求数量
# 范围：0.5-5.0
# 实盘建议值：1.5（保持默认）
BYBIT_PRIVATE_PER_SYMBOL_QUERY_BURST=1.5

# Bybit 每个交易对的订单查询请求速率
# 作用：限制每个交易对的订单查询频率
# 范围：0.1-2.0（RPS）
# 实盘建议值：0.6（保持默认）
BYBIT_PRIVATE_PER_SYMBOL_ORDER_QUERY_RPS=0.6

# Bybit 每个交易对的订单查询突发请求数
# 作用：允许的突发请求数量
# 范围：0.5-5.0
# 实盘建议值：1.2（保持默认）
BYBIT_PRIVATE_PER_SYMBOL_ORDER_QUERY_BURST=1.2

# Bybit 每个交易对的账户查询请求速率
# 作用：限制每个交易对的账户查询频率
# 范围：0.1-2.0（RPS）
# 实盘建议值：0.6（保持默认）
BYBIT_PRIVATE_PER_SYMBOL_ACCOUNT_QUERY_RPS=0.6

# Bybit 每个交易对的账户查询突发请求数
# 作用：允许的突发请求数量
# 范围：0.5-5.0
# 实盘建议值：1.2（保持默认）
BYBIT_PRIVATE_PER_SYMBOL_ACCOUNT_QUERY_BURST=1.2

# Bybit 每个交易对的关键操作请求速率
# 作用：限制每个交易对的关键操作频率
# 范围：0.5-5.0（RPS）
# 实盘建议值：1.0（保持默认）
BYBIT_PRIVATE_PER_SYMBOL_CRITICAL_RPS=1.0

# Bybit 每个交易对的关键操作突发请求数
# 作用：允许的突发请求数量
# 范围：1.0-10.0
# 实盘建议值：2.0（保持默认）
BYBIT_PRIVATE_PER_SYMBOL_CRITICAL_BURST=2.0

# Bybit 限流最大等待时间（毫秒）
# 作用：如果限流器预测等待时间超过此值，则降级处理（跳过非关键查询）
# 范围：1000-30000（1秒-30秒）
# 实盘建议值：5000（5秒，超过此时间则降级处理）
BYBIT_RATE_LIMIT_MAX_WAIT_MS=5000

# Bybit 限流低状态阈值
# 作用：限流器状态低于此值时，认为限流压力较小
# 范围：1-10
# 实盘建议值：2（保持默认）
BYBIT_RATE_LIMIT_LOW_STATUS_THRESHOLD=2

# Bybit 私有 API 是否仅查询活跃交易对
# 作用：是否只查询有持仓或订单的交易对，减少不必要的查询
# 可选值：
#   - true（仅查询活跃交易对，推荐）
#   - false（查询所有交易对）
# 实盘建议值：true（保持默认，减少不必要的查询）
BYBIT_PRIVATE_ACTIVE_SYMBOLS_ONLY=true

# ========== Bybit 缓存配置 ==========
# Bybit 钱包余额缓存 TTL（秒）
# 作用：钱包余额数据的缓存时间，减少 API 调用
# 范围：0.1-10.0（秒）
# 实盘建议值：1.0（1秒，平衡实时性和 API 压力）
BYBIT_WALLET_BALANCE_CACHE_TTL_SEC=1.0

# Bybit 持仓缓存 TTL（秒）
# 作用：持仓数据的缓存时间，减少 API 调用
# 范围：0.1-10.0（秒）
# 实盘建议值：1.0（1秒，平衡实时性和 API 压力）
BYBIT_POSITION_CACHE_TTL_SEC=1.0

# Bybit 订单实时缓存 TTL（秒）
# 作用：订单数据的缓存时间，订单状态需要更实时
# 范围：0.1-5.0（秒）
# 实盘建议值：0.5（0.5秒，订单状态需要更实时）
BYBIT_ORDER_REALTIME_CACHE_TTL_SEC=0.5

# Bybit 开放订单缓存 TTL（秒）
# 作用：开放订单列表的缓存时间
# 范围：0.1-5.0（秒）
# 实盘建议值：0.5（0.5秒，开放订单需要更实时）
BYBIT_OPEN_ORDERS_CACHE_TTL_SEC=0.5

# ========== 订单轮询 ==========
# 订单轮询间隔（秒）
# 作用：轮询订单状态的频率（当未启用 WebSocket 时）
# 范围：0.5-10.0（秒）
# 实盘建议值：1.0（1秒，保持默认）
ORDER_POLL_INTERVAL_SEC=1.0

# 订单轮询超时（秒）
# 作用：订单轮询的超时时间
# 范围：10.0-60.0（秒）
# 实盘建议值：20.0（20秒，保持默认）
ORDER_POLL_TIMEOUT_SEC=20.0

# 订单超时告警窗口（毫秒）
# 作用：订单超时告警的去重窗口，避免短时间内重复告警
# 范围：30000-300000（30秒-5分钟）
# 实盘建议值：60000（60秒，避免重复告警）
ORDER_TIMEOUT_ALERT_WINDOW_MS=60000

# ========== 对账 ==========
# 对账开放订单轮询间隔（秒）
# 作用：对账服务检查开放订单的频率
# 范围：1.0-30.0（秒）
# 实盘建议值：5.0（5秒，保持默认）
RECONCILE_OPEN_ORDERS_POLL_INTERVAL_SEC=5.0

# ========== 快照 ==========
# 账户快照间隔（秒）
# 作用：定期保存账户快照（资金、持仓）到数据库的频率
# 范围：10.0-300.0（10秒-5分钟）
# 实盘建议值：30.0（30秒，保持默认）
ACCOUNT_SNAPSHOT_INTERVAL_SEC=30.0

# ========== 告警 ==========
# 流延迟告警是否启用
# 作用：是否监控事件流的处理延迟
# 可选值：
#   - true（启用，推荐）
#   - false（禁用）
# 实盘建议值：true（保持默认，监控处理延迟）
ALERT_STREAM_LAG_ENABLED=true

# 交易计划延迟告警阈值（毫秒）
# 作用：trade_plan 事件处理延迟超过此值时触发告警
# 范围：30000-300000（30秒-5分钟）
# 实盘建议值：60000（60秒，超过此值触发告警）
ALERT_TRADE_PLAN_LAG_MS=60000

# Bar 收盘延迟告警阈值（毫秒）
# 作用：bar_close 事件处理延迟超过此值时触发告警
# 范围：60000-600000（1分钟-10分钟）
# 实盘建议值：120000（120秒，超过此值触发告警）
ALERT_BAR_CLOSE_LAG_MS=120000

# ========== 通知 ==========
# Telegram Bot Token
# 作用：Telegram Bot 的 Token，用于发送交易通知
# 获取方式：在 Telegram 中搜索 @BotFather，创建 Bot 并获取 Token
# 实盘建议：配置 Telegram Bot Token，用于接收交易通知
# 格式：数字:字母数字字符串（如 123456789:ABCdefGHIjklMNOpqrsTUVwxyz）
TELEGRAM_BOT_TOKEN=

# Telegram Chat ID
# 作用：接收通知的 Telegram Chat ID（个人或群组）
# 获取方式：在 Telegram 中搜索 @userinfobot，发送消息获取 Chat ID
# 实盘建议：配置 Telegram Chat ID，用于接收交易通知
# 格式：数字（如 123456789）
TELEGRAM_CHAT_ID=

# 通知最大重试次数
# 作用：通知发送失败时的最大重试次数
# 范围：1-10
# 实盘建议值：5（保持默认）
NOTIFIER_MAX_ATTEMPTS=5

# 通知重试循环间隔（秒）
# 作用：通知重试的间隔时间
# 范围：1.0-60.0（秒）
# 实盘建议值：5.0（5秒，保持默认）
NOTIFIER_RETRY_LOOP_INTERVAL_SEC=5.0

# ========== 管理员 ==========
# 管理员令牌（用于 API 管理操作，如紧急停止）
# 作用：用于访问管理 API 的令牌（如 /v1/admin/kill-switch）
# 安全提示：设置强密码，不要泄露给任何人
# 实盘必填：设置强密码，用于紧急停止交易
# 格式：任意字符串（建议使用随机字符串）
ADMIN_TOKEN=

# ========== 可选增强开关 ==========
# 信号评分是否启用
# 作用：是否启用信号质量评分（0-100），仅用于观察，不影响交易逻辑
# 可选值：
#   - true（启用）
#   - false（禁用，推荐）
# 实盘建议值：false（保持默认，不影响交易逻辑）
ENABLE_SIGNAL_SCORING=false

# 市场状态标记是否启用
# 作用：是否启用市场状态标记功能
# 可选值：
#   - true（启用）
#   - false（禁用，推荐）
# 实盘建议值：false（保持默认，不影响交易逻辑）
ENABLE_MARKET_STATE=false

# 订单重试是否启用
# 作用：是否启用订单重试机制（Limit 订单未成交时自动重试）
# 可选值：
#   - true（启用，推荐）
#   - false（禁用）
# 实盘建议值：true（保持默认，提高订单成功率）
ENABLE_ORDER_RETRY=true

# ========== Backtest/Paper 资金基数 ==========
# 回测资金基数（USDT）
# 作用：BACKTEST 模式下使用的初始资金
# 范围：1000.0-1000000.0（USDT）
# 实盘建议：不设置（仅用于 BACKTEST 模式）
# 说明：仅在 EXECUTION_MODE=BACKTEST 时使用
BACKTEST_EQUITY=10000

# 模拟盘资金基数（USDT）
# 作用：PAPER 模式下使用的初始资金
# 范围：1000.0-1000000.0（USDT）
# 实盘建议：不设置（仅用于 PAPER 模式）
# 说明：仅在 EXECUTION_MODE=PAPER 时使用
PAPER_EQUITY=10000
